# 要件定義書 (Requirements Definition Document)

## 1.1 プロジェクト概要
- **名称:** Open Reel Studio
- **目的:** 複数の動画生成AIモデル（Sora, Veo, Kling等）を統合管理し、クリエイターやエンジニアが映像生成の実験・制作を行うためのMacネイティブなサンドボックス環境を提供する。
- **形態:** オープンソースソフトウェア (OSS) / 非営利
- **配布形態:** GitHubでの直接配布（現時点）
- **ターゲット:**
  - 開発者本人（Primary）
  - 映像クリエイター
  - Macアプリ開発コミュニティ

## 1.2 機能要件 (Functional Requirements)

### A. MVP範囲と優先度 (Phasing)
**方針:** フェーズ1では「単一モデルでの生成・保存・再生」を最優先とし、複雑な管理機能はフェーズ2とする。

| 機能カテゴリ | Phase 1 (MVP - 今回実装) | Phase 2 (将来実装) |
| :--- | :--- | :--- |
| **モデル** | 単一モデル (Kling) | 複数モデル切り替え、比較生成 |
| **入力** | テキストプロンプト、アスペクト比選択 | 画像入力(I2V)、Magic Prompt (LLM)、シード値指定 |
| **生成** | 単発生成、ローカル保存、アプリ内完了通知 | バッチ生成、キャンセル機能、詳細なコスト計算 |
| **管理** | 履歴リスト表示、再生、削除 | お気に入り、フォルダ分け、タグ付け |
| **設定** | APIキー保存 (Keychain)、保存先フォルダ選択、ライト/ダーク | テーマカラー変更、保存先フォルダ変更の拡張 |

### B. 認証・設定 (Authentication & Settings)
- **APIキー管理:**
  - ユーザーが各サービス（OpenAI, Kling, Google）のAPIキーを入力可能。
  - **Keychain設計:**
    - Service Name: `com.vaddiction.OpenReelStudio`
    - Account Keys: `api_key_openai`, `api_key_kling`, `api_key_google`
  - アプリ内にキーをハードコードせず、キー未設定時は生成機能をロックする。
  - MVPではKlingのみ必須とし、他サービスはフェーズ2以降で有効化する。

### C. 動画生成ワークフロー (Generation Workflow)
- **画面遷移:** [設定] → [作成(Generate)] → [ギャラリー(Gallery)] の3タブ構成。
- **ユーザーフロー:**
  1. **保存先選択:** 初回生成前に保存先フォルダを選択（設定で変更可能）。
  2. **入力:** プロンプト入力 → `Generate` ボタン押下。
  3. **ジョブ発行:** 非同期タスクとしてバックグラウンドで開始。即座にUI操作可能に戻る。
  4. **監視:** アプリが一定間隔でステータスをポーリング。
  5. **完了:** アプリ内通知で完了を知らせ、動画を選択フォルダへ保存。
- **エラーハンドリング:**
  - APIエラー時はそのままコードを出さず、「APIキーが無効です」「サーバー混雑中」等の日本語メッセージを表示。
  - ネットワーク切断時は「接続待機中」とし、再接続時に自動復帰を試みる。

### D. アセット管理 (Asset Management)
- **ギャラリー:** 生成された動画をグリッド表示およびプレビュー再生。
- **メタデータ:** 動画ファイルに関連付けられたプロンプト、モデル名、シード値、設定パラメータを閲覧・コピーできること。
- **履歴:** 過去の生成ログを保持し、同じ設定での「再生成 (Reroll)」を容易にする。

## 1.3 非機能要件 (Non-Functional Requirements)
- **セキュリティ:** 外部サーバーを経由せず、クライアントから直接各AIサービスのAPIを叩く（プライバシー保護）。
- **保存容量:** 上限設定なし（ユーザーのディスク容量依存）。設定画面でキャッシュサイズ確認機能を設ける。
- **パフォーマンス:** リスト表示は100件程度までカクつきなくスクロールできること（非同期読み込み）。
- **拡張性:** 新しい動画生成モデルが登場した際、`VideoProvider` プロトコルへの準拠のみで追加実装可能な設計とする。
